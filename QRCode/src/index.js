import React, { useMemo } from "react";

import genMatrix from "./genMatrix";
import transformMatrixIntoPath from "./transformMatrixIntoPath";

const QRCode = ({
  value = "dill qr code",
  size = 244,
  color = "#184351",
  backgroundColor = "white",
  quietZone = 0,
  enableLinearGradient = false,
  gradientDirection = ["0%", "0%", "100%", "100%"],
  linearGradient = ["rgb(255,0,0)", "rgb(0,255,255)"],
  logoMarginColor = "white",
  getRef,
  borderRadius = 20,
  onError,
}) => {
  const result = useMemo(() => {
    try {
      return transformMatrixIntoPath(genMatrix(value, "H", 11), size);
    } catch (error) {
      if (onError && typeof onError === "function") {
        onError(error);
      } else {
        // Pass the error when no handler presented
        throw error;
      }
    }
  }, [value, size]);

  if (!result) {
    return null;
  }

  const { path, cellSize } = result;

  return (
    <div
      style={{
        backgroundColor: "red",
        width: 244,
        height: 244,
        overflow: "hidden",
        borderRadius: 20,
      }}
    >
      <svg
        ref={getRef}
        viewBox={[
          -quietZone,
          -quietZone,
          size + quietZone * 2,
          size + quietZone * 2,
        ].join(" ")}
        width={size}
        height={size}
      >
        <defs>
          <linearGradient
            id="grad"
            x1={gradientDirection[0]}
            y1={gradientDirection[1]}
            x2={gradientDirection[2]}
            y2={gradientDirection[3]}
          >
            <stop offset="0" stopColor={linearGradient[0]} stopOpacity="1" />
            <stop offset="1" stopColor={linearGradient[1]} stopOpacity="1" />
          </linearGradient>
        </defs>
        <g>
          <rect
            x={-quietZone}
            y={-quietZone}
            width={size + quietZone * 2}
            height={size + quietZone * 2}
            fill={backgroundColor}
          />
        </g>
        <g>
          <path
            d={path}
            strokeLinecap="butt"
            stroke={enableLinearGradient ? "url(#grad)" : color}
            strokeWidth={cellSize}
          />
        </g>
        <svg width={size} height={size} viewBox="0 0 1220 1220">
          <path
            d="M765.509 387.404L840.556 348.968L862.211 335.907L867.065 332.175L870.799 328.07L876.026 320.234L879.386 314.636L882 306.427V301.575L881.627 297.47L880.507 294.112L878.64 290.38L869.679 279.185L856.984 281.424L843.916 284.41L834.209 287.022L830.848 288.141L832.342 273.961L834.209 254.556V244.854V241.868L833.462 239.256L832.342 235.897L830.848 233.285L828.981 228.434L826.741 224.329L823.754 220.971L820.021 218.359L815.914 216.12L811.06 215H807.326L795.378 216.866L791.271 226.568L788.658 233.285L786.417 240.002L783.43 251.571L782.684 256.422L782.31 258.288L781.937 274.334L781.563 289.261L781.19 308.666L780.817 314.263L778.203 315.756L779.323 310.531L780.443 303.441L780.817 299.709V292.992L778.577 284.036L724.438 252.69L715.477 255.302L711.37 257.168L708.01 260.154L704.649 265.005L702.409 269.483L684.487 315.756L668.059 362.775L652.751 408.302L649.017 397.48L643.79 385.538L640.056 381.434L633.336 375.09L628.482 370.985L621.388 366.88L614.294 365.014H608.693L603.839 366.88L600.852 368.373L591.518 373.97V383.673L591.892 397.107L592.265 404.943L594.132 417.631L596.372 431.065L621.388 495.997L626.615 509.431L603.839 609.44L595.252 610.187H588.531L581.064 609.44H575.463H567.249H561.649L551.194 611.306L539.246 614.291L525.805 619.143L511.244 625.487L498.922 631.83L484.361 640.04L469.8 650.116L453.745 662.803L433.209 680.342L417.154 697.881L399.979 717.659L384.298 740.05L368.99 765.798L358.909 787.442L355.922 794.906L351.068 807.966L342.48 837.447L339.12 860.21L338 885.959L341.734 911.708L348.081 937.456L352.188 948.278L357.415 961.712L367.123 976.266L381.311 990.82L392.885 997.537L407.447 1003.13L425.742 1005L431.716 1004.25L442.17 1002.76L451.878 1000.15L464.572 994.924L477.267 988.954L486.975 984.102L502.656 976.266L513.111 970.295L600.106 847.149L609.44 857.225L617.281 866.181L631.469 875.883L643.417 883.72L659.845 891.183L677.393 896.408L687.474 898.273H703.156H713.61L736.012 894.169L757.668 886.705L783.43 873.644L808.819 852L818.154 839.313L823.008 828.118L824.501 818.415L822.261 808.713L818.9 801.996L810.313 794.906L801.725 791.547L787.537 790.054L768.496 791.547L758.788 793.786L750.947 796.025L719.957 806.847L691.955 819.535L685.234 817.669L679.26 813.191L674.406 805.727L671.419 788.935V775.501L672.166 759.081L674.78 739.303L682.994 703.479L707.263 626.606L726.678 565.779L740.493 505.326L765.509 387.404ZM584.424 697.508H581.064L570.236 701.24L558.288 704.225L545.22 709.45L523.565 720.645L504.523 733.333L489.588 746.393L478.014 757.962L474.28 761.32L462.332 775.501L449.638 793.786L439.93 812.071L435.076 822.893L429.102 841.925L427.235 854.24V873.271L430.596 894.169L435.076 909.469L441.423 906.856L451.131 899.02L461.585 888.944L476.147 872.152L492.948 850.881L506.016 831.849L511.99 822.893L526.178 799.384L545.22 766.545L582.184 701.24L584.424 697.508Z"
            fillRule="evenodd"
            clipRule="evenodd"
            fill={"#ffffff"}
          />
          <path
            d="M800.011 260.248L798.273 324.506L753.712 351.745C753.727 351.661 753.742 351.577 753.757 351.493C756.628 335.521 758.956 322.527 760.741 312.51C762.526 302.493 763.269 296.929 762.971 295.816L721.732 272.011C720.62 272.309 717.588 278.786 712.637 291.441C707.685 304.096 702.079 319.311 695.819 337.087C689.558 354.862 683.27 373.092 676.955 391.777C670.64 410.461 665.84 425.907 662.557 438.114C660.44 444.845 657.445 456.156 653.572 472.047C650.926 463.235 648.388 454.673 645.959 446.36C642.91 435.819 639.891 426.078 636.901 417.139C633.935 408.173 630.954 400.864 627.958 395.211C628.126 395.024 627.475 394.269 626.005 392.944L622.516 389.802C621.874 389.224 621.095 388.45 620.178 387.479C619.261 386.507 618.184 385.634 616.946 384.858C615.705 384.031 614.455 383.511 613.196 383.297C611.934 383.031 610.611 383.317 609.229 384.154C609.241 386.829 609.346 390.288 609.543 394.533C609.764 398.751 610.159 403.126 610.727 407.657C611.269 412.164 611.888 416.45 612.585 420.516C613.255 424.557 613.958 427.514 614.693 429.387L645.198 507.109C643.368 514.888 641.511 522.853 639.628 531.003C635.075 550.705 630.855 569.423 626.967 587.158C623.078 604.893 620.564 617.192 619.424 624.055L614.421 625.398C603.858 628.233 593.33 628.972 582.836 627.615C572.342 626.259 561.814 626.998 551.251 629.832C524.567 636.993 498.17 650.784 472.059 671.204C445.948 691.624 423.42 715.405 404.473 742.546C385.527 769.687 371.708 798.731 363.018 829.677C354.328 860.623 353.708 889.999 361.16 917.806C363.991 928.372 367.443 938.474 371.516 948.111C375.588 957.748 380.854 965.724 387.313 972.038C393.772 978.353 401.666 982.792 410.993 985.355C420.321 987.919 431.378 987.485 444.164 984.054L449.168 982.711C452.91 981.111 457.69 978.934 463.507 976.181C469.324 973.427 475.002 970.711 480.541 968.032C486.08 965.354 490.785 962.899 494.657 960.667L500.464 957.321L600.879 815.023C614.256 838.258 629.126 854.834 645.489 864.749C661.852 874.665 678.487 880.037 695.394 880.865C712.301 881.692 728.314 879.183 743.433 873.338C758.552 867.492 771.417 860.463 782.028 852.25C792.639 844.037 799.867 835.987 803.712 828.099C807.558 820.212 806.762 814.464 801.326 810.856C795.89 807.248 784.684 807.126 767.708 810.489C750.733 813.853 726.387 823.069 694.671 838.138C674.537 836.388 662.021 826.93 657.123 809.765C652.225 792.599 651.826 771.097 655.926 745.258C660.026 719.418 667.218 690.663 677.501 658.991C687.785 627.319 698.041 596.102 708.27 565.339C711.554 553.131 715.102 538.021 718.916 520.008C722.729 501.995 726.774 483.175 731.048 463.548C735.323 443.921 739.459 424.331 743.456 404.779C745.491 394.823 747.38 385.331 749.123 376.304C758.006 370.995 767.324 365.867 777.08 360.922C787.62 355.592 797.797 350.503 807.613 345.654C817.459 340.824 826.522 336.161 834.801 331.666C843.111 327.19 849.788 322.986 854.831 319.055C855.044 319.188 855.675 318.416 856.723 316.737L859.211 312.755C859.668 312.022 860.296 311.12 861.092 310.048C861.889 308.976 862.562 307.763 863.111 306.409C863.71 305.043 864.005 303.721 863.998 302.442C864.04 301.153 863.529 299.899 862.466 298.681C859.835 299.157 856.449 299.859 852.305 300.788C848.192 301.736 843.956 302.883 839.595 304.228C835.253 305.542 831.142 306.895 827.262 308.286C823.4 309.646 820.612 310.851 818.897 311.899L809.996 317.34C810.262 311.25 810.736 305.018 811.419 298.642C812.229 291.356 813.025 284.334 813.805 277.578C814.618 270.807 815.249 264.497 815.698 258.65C816.181 252.787 816.258 247.887 815.931 243.95C816.062 243.889 815.868 243.304 815.352 242.195L814.097 239.505C813.869 239.015 813.613 238.381 813.328 237.6C813.044 236.82 812.647 236.052 812.136 235.297C811.625 234.543 811.03 233.947 810.35 233.51C809.703 233.058 808.878 232.906 807.876 233.056C807.239 234.584 806.468 236.591 805.563 239.078C804.643 241.532 803.791 244.132 803.008 246.88C802.242 249.58 801.567 252.177 800.984 254.673C800.386 257.135 800.061 258.994 800.011 260.248ZM415.616 905.874C414.702 901.35 413.797 897.42 412.903 894.083C407.091 872.394 407.729 850.315 414.818 827.847C421.907 805.378 432.863 784.554 447.686 765.375C462.509 746.196 479.921 729.452 499.923 715.142C519.924 700.832 539.932 690.992 559.945 685.621C562.724 684.875 566.301 683.767 570.674 682.295C575.046 680.823 579.429 679.945 583.822 679.66C588.215 679.376 592.276 680.074 596.004 681.756C599.732 683.438 602.267 686.782 603.608 691.787C603.757 692.343 603.73 692.798 603.527 693.15C603.323 693.503 603.371 694.235 603.669 695.348L604.339 697.85C601.64 703.344 596.628 712.438 589.304 725.134C581.98 737.83 574.185 751.546 565.918 766.283C557.651 781.02 549.615 794.95 541.81 808.073C534.004 821.196 528.677 830.226 525.829 835.164C522.832 839.545 517.993 846.506 511.314 856.049C504.635 865.591 497.26 875.319 489.191 885.234C481.122 895.15 472.653 904.129 463.784 912.172C454.915 920.215 446.867 925.207 439.64 927.146C434.637 928.489 430.512 928.106 427.265 925.996C424.018 923.887 421.494 921.137 419.691 917.746C417.889 914.355 416.53 910.397 415.616 905.874Z"
            fillRule="evenodd"
            clipRule="evenodd"
            fill={color}
          />
          <rect width={120} height={120} fill={backgroundColor} />
          <rect x="1100" width="120" height="120" fill={backgroundColor} />

          <rect y="1100" width="120" height="120" fill={backgroundColor} />

          <path
            d="M1100 1220C1166.27 1220 1220 1166.27 1220 1100V1220H1100Z"
            fillRule="evenodd"
            clipRule="evenodd"
            fill={color}
          />

          <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M100 40C66.8629 40 40 66.8629 40 100H100V40Z"
            fill={color}
          />
          <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M100 0H120V20H100C55.8172 20 20 55.8172 20 100V120H0V100C0 44.7715 44.7715 0 100 0Z"
            fill={color}
          />

          <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M100 1180C66.8629 1180 40 1153.14 40 1120H100V1180Z"
            fill={color}
          />
          <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M100 1220H120V1200H100C55.8172 1200 20 1164.18 20 1120V1100H0V1120C0 1175.23 44.7715 1220 100 1220Z"
            fill={color}
          />
          <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M1120 40C1153.14 40 1180 66.8629 1180 100H1120V40Z"
            fill={color}
          />
          <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M1120 0H1100V20H1120C1164.18 20 1200 55.8172 1200 100V120H1220V100C1220 44.7715 1175.23 0 1120 0Z"
            fill={color}
          />
        </svg>
      </svg>
    </div>
  );
};

export default QRCode;
